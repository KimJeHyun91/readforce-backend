# 이 파일을 프로젝트의 루트 디렉터리에 생성하세요.
services:
  # Spring Boot 애플리케이션 서비스
  - type: web
    name: readforce-backend
    env: spring
    plan: free # 필요에 따라 요금제 변경 가능 (예: 'starter')
    buildCommand: "./gradlew build"
    startCommand: "java -Dserver.port=10000 -jar build/libs/readforce-0.0.1-SNAPSHOT.jar"
    healthCheckPath: "/actuator/health" # 애플리케이션 상태 확인 경로
    envVars:
      # Render가 데이터베이스 정보를 자동으로 주입해주는 부분
      - key: SPRING_DATASOURCE_URL
        fromDatabase:
          name: readforce-db
          property: url
      - key: SPRING_DATASOURCE_USERNAME
        fromDatabase:
          name: readforce-db
          property: user
      - key: SPRING_DATASOURCE_PASSWORD
        fromDatabase:
          name: readforce-db
          property: password
      
      # Render가 Redis 정보를 자동으로 주입해주는 부분
      - key: SPRING_DATA_REDIS_HOST
        fromService:
          type: redis
          name: readforce-redis
          property: host
      - key: SPRING_DATA_REDIS_PORT
        fromService:
          type: redis
          name: readforce-redis
          property: port
          
      # 🚨 사용자가 Render 대시보드에서 직접 입력해야 할 환경변수들
      # value를 적지 않고 key만 선언합니다.
      - key: GEMINI_API_KEY
      - key: GMAIL_PASSWORD
      - key: GMAIL_USERNAME
      - key: GOOGLE_CLIENT_ID
      - key: GOOGLE_CLIENT_SECRET
      - key: JWT_SECRET_KEY
      - key: KAKAO_CLIENT_ID
      - key: KAKAO_CLIENT_SECRET

  # PostgreSQL 데이터베이스
  - type: db
    name: readforce-db
    databaseName: readforce   # 생성될 데이터베이스 이름
    databaseUser: readforce   # 생성될 사용자 이름
    plan: free # 필요에 따라 요금제 변경 가능
    postgresMajorVersion: 15 # PostgreSQL 버전

  # Redis
  - type: redis
    name: readforce-redis
    plan: free # 필요에 따라 요금제 변경 가능